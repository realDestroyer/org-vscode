{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "vso",
  "scopeName": "source.vso",
  "patterns": [
    {
      "name": "entity.other.attribute-name.tag.vso",
      "comment": "Inline TAG block",
      "match": "\\[\\+TAG:[^\\]]*\\]"
    },
    {
      "name": "meta.directive.vso",
      "comment": "Org metadata directive",
      "match": "^\\s*#\\+[A-Z0-9_@-]+:.*$"
    },
    {
      "name": "meta.block.property.vso",
      "comment": "Org property drawer",
      "begin": "^\\s*:PROPERTIES:\\s*$",
      "end": "^\\s*:END:\\s*$",
      "patterns": [
        {
          "name": "variable.other.property-key.vso",
          "match": "^\\s*:[A-Z0-9_@#%+\\-]+:\\s+.*$"
        }
      ]
    },
    {
      "name": "constant.character.in_progress.vso",
      "comment": "In Progress Task (asterisk heading)",
      "begin": "^\\s*\\*+\\s+(?=IN_PROGRESS\\b)",
      "end": "$",
      "patterns": [
        { "include": "#in_progress" },
        { "include": "#tag" },
        { "include": "#task_text_in_progress" },
        { "include": "#sched" },
        { "include": "#scheduled" },
        { "include": "#deadline" },
        { "include": "#closed" }
      ]
    },
    {
      "name": "constant.character.abandoned.vso",
      "comment": "Abandoned Task (asterisk heading)",
      "begin": "^\\s*\\*+\\s+(?=ABANDONED\\b)",
      "end": "$",
      "patterns": [
        { "include": "#abandoned" },
        { "include": "#task_text_abandoned" },
        { "include": "#sched" },
        { "include": "#scheduled" },
        { "include": "#deadline" },
        { "include": "#closed" }
      ]
    },
    {
      "name": "constant.character.continued.vso",
      "comment": "Continued Task (asterisk heading)",
      "begin": "^\\s*\\*+\\s+(?=CONTINUED\\b)",
      "end": "$",
      "patterns": [
        { "include": "#continued" },
        { "include": "#tag" },
        { "include": "#task_text_continued" },
        { "include": "#sched" },
        { "include": "#scheduled" },
        { "include": "#deadline" },
        { "include": "#closed" }
      ]
    },
    {
      "name": "constant.character.todo.vso",
      "comment": "TODO Task (asterisk heading)",
      "begin": "^\\s*\\*+\\s+(?=TODO\\b)",
      "end": "$",
      "patterns": [
        { "include": "#todo" },
        { "include": "#tag" },
        { "include": "#task_text_todo" },
        { "include": "#sched" },
        { "include": "#scheduled" },
        { "include": "#deadline" },
        { "include": "#closed" }
      ]
    },
    {
      "name": "constant.character.done.vso",
      "comment": "DONE Task (asterisk heading)",
      "begin": "^\\s*\\*+\\s+(?=DONE\\b)",
      "end": "$",
      "patterns": [
        { "include": "#done" },
        { "include": "#tag" },
        { "include": "#task_text_done" },
        { "include": "#sched" },
        { "include": "#scheduled" },
        { "include": "#deadline" },
        { "include": "#closed" }
      ]
    },
    {
      "name": "constant.character.in_progress.vso",
      "comment": "In Progress Task Symbol",
      "begin": "^\\s*[\u2298]",
      "end": "$",
      "patterns": [
        { "include": "#in_progress" },
        { "include": "#tag" },
        { "include": "#task_text_in_progress" },
        { "include": "#sched" },
        { "include": "#scheduled" },
        { "include": "#deadline" },
        { "include": "#closed" }
      ]
    },
    {
      "name": "constant.character.abandoned.vso",
      "comment": "Abandoned Task Symbol",
      "begin": "^\\s*[\u2297]",
      "end": "$",
      "patterns": [
        { "include": "#abandoned" },
        { "include": "#task_text_abandoned" },
        { "include": "#sched" },
        { "include": "#scheduled" },
        { "include": "#deadline" },
        { "include": "#closed" }
      ]
    },
    {
      "name": "constant.character.continued.vso",
      "begin": "^\\s*[⊜]",
      "end": "$",
      "patterns": [
        { "include": "#continued" },
        { "include": "#tag" },
        { "include": "#task_text_continued" },
        { "include": "#sched" },
        { "include": "#scheduled" },
        { "include": "#deadline" },
        { "include": "#closed" }
      ]
    },
    {
      "name": "constant.character.todo.vso",
      "begin": "^\\s*[⊙]",
      "end": "$",
      "patterns": [
        { "include": "#todo" },
        { "include": "#tag" },
        { "include": "#task_text_todo" },
        { "include": "#sched" },
        { "include": "#scheduled" },
        { "include": "#deadline" },
        { "include": "#closed" }
      ]
    },
    {
      "name": "constant.character.done.vso",
      "begin": "^\\s*[\u2296]",
      "end": "$",
      "patterns": [
        { "include": "#tag" },
        { "include": "#done" },
        { "include": "#task_text_done" },
        { "include": "#sched" },
        { "include": "#scheduled" },
        { "include": "#deadline" },
        { "include": "#closed" }
      ]
    },
    {
      "name": "constant.numeric.date.vso",
      "match": "\\[(\\d{2}-\\d{2}-\\d{4})\\]"
    },
    {
      "name": "constant.numeric.date.header.vso",
      "match": "\\[\\d{2}-\\d{2}-\\d{4} \\w{3}\\]"
    },
    {
      "name": "markup.heading.vso",
      "comment": "Heading 1 unformatted",
      "begin": "^\\s*\\*\\s+",
      "end": "$"
    },
    {
      "name": "keyword.other.vso",
      "comment": "Heading 2 unformatted",
      "begin": "^\\s*(\\*{2})\\s+",
      "end": "$"
    },
    {
      "name": "keyword.operator.vso",
      "comment": "Heading 3 unformatted",
      "begin": "^\\s*(\\*{3})\\s+",
      "end": "$"
    },
    {
      "name": "comment.vso",
      "comment": "#+ directives as comments",
      "begin": "(\\#\\+)",
      "end": "$"
    },
    {
      "name": "keyword.closed.vso",
      "match": "\\b(?:CLOSED|COMPLETED)\\b"
    },
    { "include": "#scheduled" },
    { "include": "#deadline" },
    { "include": "#closed" },
    { "include": "#timestamp" }
  ],
  "repository": {
    "scheduled": {
      "patterns": [
        {
          "name": "keyword.scheduled.vso",
          "match": "SCHEDULED:\\s*\\[(?:\\d{4}-\\d{2}-\\d{2}|\\d{2}-\\d{2}-\\d{4})(?:\\s+\\d{2}:\\d{2}(?::\\d{2})?)?\\]"
        }
      ]
    },
    "deadline": {
      "patterns": [
        {
          "name": "markup.deleted.deadline.vso",
          "match": "DEADLINE:\\s*\\[(?:\\d{4}-\\d{2}-\\d{2}|\\d{2}-\\d{2}-\\d{4})(?:\\s+\\d{2}:\\d{2}(?::\\d{2})?)?\\]"
        }
      ]
    },
    "closed": {
      "patterns": [
        {
          "name": "keyword.closed.vso",
          "match": "^\\s*(?:CLOSED|COMPLETED):\\s*\\[(?:\\d{4}-\\d{2}-\\d{2}|\\d{2}-\\d{2}-\\d{4})(?:\\s+\\w{3})?(?:\\s+\\d{2}:\\d{2}(?::\\d{2})?)?\\]"
        }
      ]
    },
    "timestamp": {
      "patterns": [
        {
          "name": "constant.other.timestamp.vso",
          "match": "[<\\[](?:\\d{4}-\\d{2}-\\d{2})(?:\\s+\\w{3})?(?:\\s+\\d{2}:\\d{2}(?::\\d{2})?)?[>\\]]"
        }
      ]
    },
    "todo": {
      "patterns": [
        { "name": "keyword.control.todo.vso", "match": "\\bTODO\\b" }
      ]
    },
    "task_text_todo": {
      "patterns": [
        {
          "name": "string.task.todo.vso",
          "match": "(?<=TODO\\s+).*?(?=(?:\\s+(?:SCHEDULED:|DEADLINE:|CLOSED:|COMPLETED:))|(?:\\s+:(?:[A-Za-z0-9_@#%\\-]+:)+(?=\\s+(?:SCHEDULED:|DEADLINE:|CLOSED:|COMPLETED:)))|(?:\\s+:(?:[A-Za-z0-9_@#%\\-]+:)+\\s*$)|$)"
        }
      ]
    },
    "task_text_in_progress": {
      "patterns": [
        {
          "name": "string.task.in_progress.vso",
          "match": "(?<=IN_PROGRESS\\s+).*?(?=(?:\\s+(?:SCHEDULED:|DEADLINE:|CLOSED:|COMPLETED:))|(?:\\s+:(?:[A-Za-z0-9_@#%\\-]+:)+(?=\\s+(?:SCHEDULED:|DEADLINE:|CLOSED:|COMPLETED:)))|(?:\\s+:(?:[A-Za-z0-9_@#%\\-]+:)+\\s*$)|$)"
        }
      ]
    },
    "task_text_done": {
      "patterns": [
        {
          "name": "string.task.done.vso",
          "match": "(?<=DONE\\s+).*?(?=(?:\\s+(?:SCHEDULED:|DEADLINE:|CLOSED:|COMPLETED:))|(?:\\s+:(?:[A-Za-z0-9_@#%\\-]+:)+(?=\\s+(?:SCHEDULED:|DEADLINE:|CLOSED:|COMPLETED:)))|(?:\\s+:(?:[A-Za-z0-9_@#%\\-]+:)+\\s*$)|$)"
        }
      ]
    },
    "task_text_abandoned": {
      "patterns": [
        {
          "name": "string.task.abandoned.vso",
          "match": "(?<=ABANDONED\\s+).*?(?=(?:\\s+(?:SCHEDULED:|DEADLINE:|CLOSED:|COMPLETED:))|(?:\\s+:(?:[A-Za-z0-9_@#%\\-]+:)+(?=\\s+(?:SCHEDULED:|DEADLINE:|CLOSED:|COMPLETED:)))|(?:\\s+:(?:[A-Za-z0-9_@#%\\-]+:)+\\s*$)|$)"
        }
      ]
    },
    "task_text_continued": {
      "patterns": [
        {
          "name": "string.task.continued.vso",
          "match": "(?<=CONTINUED\\s+).*?(?=(?:\\s+(?:SCHEDULED:|DEADLINE:|CLOSED:|COMPLETED:))|(?:\\s+:(?:[A-Za-z0-9_@#%\\-]+:)+(?=\\s+(?:SCHEDULED:|DEADLINE:|CLOSED:|COMPLETED:)))|(?:\\s+:(?:[A-Za-z0-9_@#%\\-]+:)+\\s*$)|$)"
        }
      ]
    },
    "done": {
      "patterns": [
        { "name": "entity.name.function.vso", "match": "\\bDONE\\b" }
      ]
    },
    "sched": {
      "patterns": [
        { "name": "keyword.closed.vso", "match": "^\\s*(?:CLOSED|COMPLETED):\\s*\\[.*?\\]" }
      ]
    },
    "abandoned": {
      "patterns": [
        { "name": "keyword.control.abandoned.vso", "match": "\\bABANDONED\\b" }
      ]
    },
    "continued": {
      "patterns": [
        { "name": "markup.quote.continued.vso", "match": "\\bCONTINUED\\b" }
      ]
    },
    "in_progress": {
      "patterns": [
        { "name": "support.constant.in_progress.vso", "match": "\\bIN_PROGRESS\\b" }
      ]
    },
    "tag": {
      "patterns": [
        { "name": "entity.other.attribute-name.tag.vso", "match": "(?:\\[\\+TAG:[^\\]]*\\])|(?:\\s+:(?:[A-Za-z0-9_@#%\\-]+:)+(?=\\s+(?:SCHEDULED:|DEADLINE:|CLOSED:|COMPLETED:)|\\s*$))" }
      ]
    }
  }
}
